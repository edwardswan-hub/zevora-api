<!DOCTYPE html>
<html lang="zh-CN" class="dark scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>JULIAN. / Omnia</title>

  <!-- Tailwind & Marked.js & DOMPurify -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.6/dist/purify.min.js"></script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;0,800;1,400&family=Inter:wght@300;400;500&family=JetBrains+Mono:wght@400&display=swap');

    :root {
      --bg: #050505;
      --text-primary: #f8f8f8;
      --text-muted: #666666;
      --border: #222222;
    }

    body {
      background-color: var(--bg);
      color: var(--text-primary);
      font-family: 'Inter', sans-serif;
      -webkit-font-smoothing: antialiased;
    }

    .noise {
      position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
      pointer-events: none; z-index: 999; opacity: 0.03;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
    }

    .font-serif { font-family: 'Playfair Display', serif; }
    .font-mono { font-family: 'JetBrains Mono', monospace; }

    .prose { max-width: 65ch; margin: 0 auto; font-size: 1.125rem; line-height: 1.8; color: #d1d5db; }
    .prose h1 { font-family: 'Playfair Display', serif; font-size: 3rem; font-weight: 800; line-height: 1.1; margin-bottom: 2rem; color: #fff; }
    .prose h2 { font-family: 'Playfair Display', serif; font-size: 2rem; font-weight: 600; margin-top: 3rem; margin-bottom: 1rem; color: #fff; }
    .prose p { margin-bottom: 1.5rem; font-weight: 300; }
    .prose strong { color: #fff; font-weight: 500; }
    .prose a { color: #fff; text-decoration: none; border-bottom: 1px solid #666; transition: border-color 0.3s; }
    .prose a:hover { border-bottom-color: #fff; }
    .prose blockquote { border-left: 1px solid #fff; padding-left: 1.5rem; margin-left: 0; font-style: italic; color: #9ca3af; }
    .prose pre { background: #111; padding: 1.5rem; border: 1px solid var(--border); overflow-x: auto; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; margin-bottom: 1.5rem; }
    .prose code { font-family: 'JetBrains Mono', monospace; font-size: 0.85em; color: #e5e5e5; }
    .prose ul, .prose ol { margin-bottom: 1.5rem; padding-left: 1.2rem; }
    .prose li { margin-bottom: 0.5rem; list-style-type: square; }

    .hover-underline { position: relative; text-decoration: none; }
    .hover-underline::after {
      content: ''; position: absolute; width: 100%; transform: scaleX(0);
      height: 1px; bottom: 0; left: 0; background-color: currentColor;
      transform-origin: bottom right; transition: transform 0.4s cubic-bezier(0.86, 0, 0.07, 1);
    }
    .hover-underline:hover::after { transform: scaleX(1); transform-origin: bottom left; }

    .reader-overlay { transition: opacity 0.5s ease; }
    .reader-content { transition: transform 0.6s cubic-bezier(0.16, 1, 0.3, 1); }

    ::-webkit-scrollbar { width: 2px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #444; }
  </style>
</head>

<body class="selection:bg-white selection:text-black antialiased relative">

  <div class="noise"></div>

  <!-- Header -->
  <header class="fixed top-0 w-full z-40 bg-gradient-to-b from-[#050505] to-transparent pt-6 pb-12 px-8 flex justify-between items-start mix-blend-difference">
    <div class="text-xs uppercase tracking-[0.2em] font-medium text-gray-400">
      <span id="liveTime">00:00:00</span> <br>
      CHENGDU, CHN
    </div>
    <div class="text-center cursor-pointer" onclick="window.scrollTo(0,0)">
      <h1 class="font-serif text-3xl font-bold tracking-tighter">JULIAN.</h1>
    </div>
    <div class="text-right">
      <button id="cmdBtn" class="text-xs uppercase tracking-[0.2em] font-medium text-gray-400 hover-underline">
        MENU / CMD+K
      </button>
    </div>
  </header>

  <!-- Main -->
  <main class="pt-40 pb-32 px-8 max-w-6xl mx-auto">

    <!-- Hero -->
    <section class="mb-32">
      <h2 class="font-serif text-[10vw] leading-[0.85] font-extrabold tracking-tighter text-[#f8f8f8] mb-8">
        Chaos,<br>
        <span class="text-gray-600 italic font-normal">Synthesized.</span>
      </h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8 border-t border-[#222] pt-8">
        <div class="col-span-1 md:col-span-2">
          <p class="text-xl text-gray-400 font-light leading-relaxed max-w-xl">
            Building multi-agent systems, unraveling organic chemistry, and trying to survive the week.
            Currently operating under the strict policy of <i>"In Omnia Paratus"</i>.
          </p>
        </div>
        <div class="text-sm text-gray-500 font-mono flex flex-col justify-end">
          <p>STATUS: DEEP WORK</p>
          <p>BGM: THE TORTURED POETS DEPARTMENT</p>
        </div>
      </div>
    </section>

    <!-- Archive -->
    <section>
      <div class="flex justify-between items-end border-b border-[#333] pb-4 mb-8">
        <h3 class="text-xs uppercase tracking-[0.2em] text-gray-400">The Archive</h3>
        <button id="newPostBtn" class="text-xs uppercase tracking-[0.2em] hover-underline text-white">+ New Entry</button>
      </div>

      <div id="postList" class="flex flex-col">
        <!-- JS Injected -->
      </div>
    </section>

  </main>

  <!-- Reader / Editor -->
  <div id="readerOverlay" class="fixed inset-0 bg-[#050505] z-50 hidden opacity-0 reader-overlay overflow-y-auto">

    <nav class="sticky top-0 w-full px-8 py-6 flex justify-between items-center bg-[#050505]/90 backdrop-blur-md z-10 border-b border-[#111]">
      <button id="btnBack" class="text-xs uppercase tracking-[0.2em] text-gray-400 hover-underline flex items-center gap-2">
        ‚Üê Return
      </button>
      <div class="flex gap-6">
        <button id="btnEdit" class="text-xs uppercase tracking-[0.2em] text-gray-400 hover-underline">Edit</button>
        <button id="btnDelete" class="text-xs uppercase tracking-[0.2em] text-red-900 hover:text-red-500 transition-colors hidden">Delete</button>
      </div>
    </nav>

    <div class="max-w-3xl mx-auto px-8 py-20 reader-content translate-y-10" id="readerContent">

      <!-- View Mode -->
      <div id="viewMode">
        <div class="mb-12 text-center">
          <p id="vMeta" class="text-xs uppercase tracking-[0.2em] text-gray-500 mb-6 font-mono"></p>
          <h1 id="vTitle" class="font-serif text-5xl md:text-6xl font-bold leading-tight mb-8"></h1>
        </div>
        <article id="vBody" class="prose"></article>
      </div>

      <!-- Edit Mode -->
      <div id="editMode" class="hidden flex flex-col h-full min-h-[60vh]">
        <input id="eTitle" class="w-full bg-transparent font-serif text-4xl font-bold text-white outline-none mb-6 placeholder-gray-700" placeholder="A brilliant title...">
        <div class="flex gap-4 mb-8 border-b border-[#222] pb-6">
          <input id="eDate" type="date" class="bg-transparent font-mono text-sm text-gray-500 outline-none uppercase tracking-widest">
          <input id="eTags" class="flex-1 bg-transparent font-mono text-sm text-gray-500 outline-none uppercase tracking-widest placeholder-gray-800" placeholder="TAGS (COMMA SEPARATED)">
        </div>
        <textarea id="eBody" class="flex-1 w-full bg-transparent text-gray-300 font-mono text-sm leading-relaxed outline-none resize-none placeholder-gray-800" placeholder="# Start writing the truth here..."></textarea>

        <div class="mt-10">
          <button id="btnSave" class="w-full border border-[#333] hover:border-white text-xs uppercase tracking-[0.2em] py-4 transition-colors">
            Publish to Local Storage
          </button>
        </div>
      </div>

    </div>
  </div>

  <!-- Command Palette -->
  <div id="cmd" class="fixed inset-0 z-[100] hidden flex items-center justify-center">
    <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" id="cmdOverlay"></div>
    <div class="relative w-full max-w-2xl px-8">
      <div class="border-b border-[#333] flex items-center pb-4 mb-4">
        <span class="text-gray-600 font-mono mr-4">></span>
        <input id="cmdInput" type="text" class="w-full bg-transparent text-2xl font-serif text-white outline-none placeholder-gray-800" placeholder="Type command or search..." autocomplete="off">
      </div>
      <div id="cmdResults" class="font-mono text-sm text-gray-500 flex flex-col gap-2">
        <!-- Results injected here -->
      </div>
    </div>
  </div>

  <script>
    /***********************
     *  Utils & Settings
     ***********************/
    const STORAGE_KEY = "omnia_posts_v1";
    const $ = (id) => document.getElementById(id);

    const safeISODate = (d = new Date()) => {
      const tzOff = d.getTimezoneOffset() * 60000;
      return new Date(d.getTime() - tzOff).toISOString().slice(0, 10);
    };

    const normalizeTags = (raw) => {
      if (!raw) return [];
      return raw
        .split(",")
        .map(s => s.trim())
        .filter(Boolean)
        .map(s => s.toUpperCase())
        .slice(0, 12);
    };

    const humanMeta = (post) => {
      const tags = (post.tags || []).join(" ¬∑ ");
      return `${post.date || ""}${tags ? " ¬∑ " + tags : ""}`;
    };

    /***********************
     *  Clock
     ***********************/
    function updateClock() {
      const now = new Date();
      $("liveTime").innerText = now.toLocaleTimeString("en-US", { hour12: false, timeZone: "Asia/Shanghai" });
    }
    setInterval(updateClock, 1000);
    updateClock();

    /***********************
     *  Markdown Rendering (sanitized)
     ***********************/
    marked.setOptions({ gfm: true, breaks: true });
    const renderMarkdown = (md) => {
      const html = marked.parse(md || "");
      return DOMPurify.sanitize(html, { USE_PROFILES: { html: true } });
    };

    /***********************
     *  Data
     ***********************/
    const defaultPosts = [
      {
        id: crypto.randomUUID(),
        title: "I can do it with a broken heart",
        date: "2026-02-23",
        tags: ["CODE", "VIBES"],
        body:
`*'I cry a lot but I am so productive, it's an art.'*

Writing multi-agent loops today. Every time the LLM hallucinates, a small part of my soul leaves my body.  
But we push through.

## Notes
- architecture: clean  
- execution: brutal  
- mood: üòê

> In Omnia Paratus. Even when I'm not.`,
        createdAt: Date.now(),
        updatedAt: Date.now()
      },
      {
        id: crypto.randomUUID(),
        title: "Deep Work, Loud Thoughts",
        date: "2026-02-22",
        tags: ["LIFE", "FOCUS"],
        body:
`I don't need motivation.  
I need **less TikTok** and more **ship**.

### Rule
If it's not moving the needle, it's noise.`,
        createdAt: Date.now() - 86400000,
        updatedAt: Date.now() - 86400000
      }
    ];

    let posts = [];
    let activeId = null;

    const loadPosts = () => {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) {
          localStorage.setItem(STORAGE_KEY, JSON.stringify(defaultPosts));
          posts = [...defaultPosts];
          return;
        }
        const parsed = JSON.parse(raw);
        posts = Array.isArray(parsed) ? parsed : [];
        if (!posts.length) posts = [...defaultPosts];
      } catch {
        posts = [...defaultPosts];
      }
    };

    const savePosts = () => {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(posts));
    };

    const sortPosts = () => {
      // Primary: date desc, Secondary: updatedAt desc
      posts.sort((a, b) => {
        const da = (a.date || "").replaceAll("-", "");
        const db = (b.date || "").replaceAll("-", "");
        if (da !== db) return db.localeCompare(da);
        return (b.updatedAt || 0) - (a.updatedAt || 0);
      });
    };

    /***********************
     *  UI: Archive List
     ***********************/
    const postRow = (post) => {
      const tags = (post.tags || []).slice(0, 4);
      const tagStr = tags.length ? tags.join(" ¬∑ ") : "UNTAGGED";
      return `
        <button data-id="${post.id}"
          class="group w-full text-left py-8 border-b border-[#111] hover:border-[#333] transition-colors">
          <div class="flex flex-col md:flex-row md:items-baseline md:justify-between gap-4">
            <div>
              <h4 class="font-serif text-2xl md:text-3xl text-white tracking-tight group-hover:opacity-80 transition-opacity">
                ${escapeHTML(post.title || "Untitled")}
              </h4>
              <p class="mt-2 text-xs uppercase tracking-[0.2em] text-gray-500 font-mono">
                ${escapeHTML(post.date || "")}
              </p>
            </div>
            <div class="text-xs uppercase tracking-[0.2em] text-gray-600 font-mono md:text-right">
              ${escapeHTML(tagStr)}
            </div>
          </div>
        </button>
      `;
    };

    const escapeHTML = (s) => {
      return String(s || "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    };

    const renderList = (filter = "") => {
      const container = $("postList");
      const q = filter.trim().toLowerCase();
      const list = !q ? posts : posts.filter(p => {
        const blob = `${p.title||""} ${(p.tags||[]).join(" ")} ${p.body||""} ${p.date||""}`.toLowerCase();
        return blob.includes(q);
      });

      if (!list.length) {
        container.innerHTML = `
          <div class="py-16 text-center text-gray-600 font-mono text-sm">
            No entries. Type <span class="text-gray-400">new</span> in CMD+K.
          </div>
        `;
        return;
      }

      container.innerHTML = list.map(postRow).join("");
      container.querySelectorAll("button[data-id]").forEach(btn => {
        btn.addEventListener("click", () => openPost(btn.dataset.id));
      });
    };

    /***********************
     *  Reader Overlay
     ***********************/
    const showReader = () => {
      const overlay = $("readerOverlay");
      overlay.classList.remove("hidden");
      requestAnimationFrame(() => {
        overlay.classList.remove("opacity-0");
        $("readerContent").classList.remove("translate-y-10");
      });
      document.body.style.overflow = "hidden";
    };

    const hideReader = () => {
      const overlay = $("readerOverlay");
      overlay.classList.add("opacity-0");
      $("readerContent").classList.add("translate-y-10");
      setTimeout(() => {
        overlay.classList.add("hidden");
        document.body.style.overflow = "";
        setMode("view");
        activeId = null;
      }, 220);
    };

    const setMode = (mode) => {
      const isEdit = mode === "edit";
      $("viewMode").classList.toggle("hidden", isEdit);
      $("editMode").classList.toggle("hidden", !isEdit);
      $("btnDelete").classList.toggle("hidden", !activeId);
      $("btnEdit").innerText = isEdit ? "View" : "Edit";
    };

    const openPost = (id) => {
      const post = posts.find(p => p.id === id);
      if (!post) return;
      activeId = id;

      $("vTitle").innerText = post.title || "Untitled";
      $("vMeta").innerText = humanMeta(post);
      $("vBody").innerHTML = renderMarkdown(post.body || "");

      // preload editor fields
      $("eTitle").value = post.title || "";
      $("eDate").value = post.date || safeISODate();
      $("eTags").value = (post.tags || []).join(", ");
      $("eBody").value = post.body || "";

      setMode("view");
      showReader();
    };

    const openNew = () => {
      activeId = null;
      $("eTitle").value = "";
      $("eDate").value = safeISODate();
      $("eTags").value = "VIBES";
      $("eBody").value = "# New entry\n\nSay something that matters.";
      $("vTitle").innerText = "";
      $("vMeta").innerText = "";
      $("vBody").innerHTML = "";

      setMode("edit");
      showReader();
      $("eTitle").focus();
      $("btnDelete").classList.add("hidden");
    };

    const upsertActive = () => {
      const title = ($("eTitle").value || "").trim() || "Untitled";
      const date = $("eDate").value || safeISODate();
      const tags = normalizeTags($("eTags").value || "");
      const body = $("eBody").value || "";

      const now = Date.now();

      if (!activeId) {
        const id = crypto.randomUUID();
        posts.push({ id, title, date, tags, body, createdAt: now, updatedAt: now });
        activeId = id;
      } else {
        const idx = posts.findIndex(p => p.id === activeId);
        if (idx >= 0) {
          posts[idx] = {
            ...posts[idx],
            title, date, tags, body,
            updatedAt: now
          };
        }
      }

      sortPosts();
      savePosts();
      renderList();

      // refresh view
      openPost(activeId);
    };

    const deleteActive = () => {
      if (!activeId) return;
      const ok = confirm("Delete this entry? This cannot be undone.");
      if (!ok) return;

      posts = posts.filter(p => p.id !== activeId);
      savePosts();
      sortPosts();
      renderList();
      hideReader();
    };

    /***********************
     *  Command Palette
     ***********************/
    const openCmd = () => {
      $("cmd").classList.remove("hidden");
      $("cmdInput").value = "";
      renderCmdHelp();
      $("cmdInput").focus();
      document.body.style.overflow = "hidden";
    };

    const closeCmd = () => {
      $("cmd").classList.add("hidden");
      document.body.style.overflow = "";
    };

    const renderCmdHelp = () => {
      $("cmdResults").innerHTML = `
        <div class="text-gray-500">Commands:</div>
        <div class="text-gray-400">‚Ä¢ <span class="text-white">new</span> ‚Äî create entry</div>
        <div class="text-gray-400">‚Ä¢ <span class="text-white">search</span> &lt;term&gt; ‚Äî filter archive</div>
        <div class="text-gray-400">‚Ä¢ <span class="text-white">open</span> &lt;#&gt; ‚Äî open result index</div>
        <div class="text-gray-400">‚Ä¢ <span class="text-white">export</span> ‚Äî download JSON backup</div>
        <div class="text-gray-400">‚Ä¢ <span class="text-white">clear</span> ‚Äî wipe local storage</div>
        <div class="text-gray-400">‚Ä¢ <span class="text-white">help</span> ‚Äî show this</div>
      `;
    };

    let lastSearchResults = [];

    const renderSearchResults = (q) => {
      const term = q.trim().toLowerCase();
      const list = !term ? posts : posts.filter(p => {
        const blob = `${p.title||""} ${(p.tags||[]).join(" ")} ${p.body||""} ${p.date||""}`.toLowerCase();
        return blob.includes(term);
      });

      lastSearchResults = list.slice(0, 8);

      if (!lastSearchResults.length) {
        $("cmdResults").innerHTML = `<div>No matches. Try another term.</div>`;
        return;
      }

      $("cmdResults").innerHTML = lastSearchResults.map((p, i) => `
        <button class="text-left hover:text-white transition-colors"
          data-open-index="${i}">
          [${i+1}] ${escapeHTML(p.title || "Untitled")} <span class="text-gray-700">(${escapeHTML(p.date||"")})</span>
        </button>
      `).join("");

      $("cmdResults").querySelectorAll("button[data-open-index]").forEach(btn => {
        btn.addEventListener("click", () => {
          const idx = Number(btn.dataset.openIndex);
          const post = lastSearchResults[idx];
          if (!post) return;
          closeCmd();
          openPost(post.id);
        });
      });
    };

    const exportJSON = () => {
      const blob = new Blob([JSON.stringify(posts, null, 2)], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = `omnia_export_${safeISODate()}.json`;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    };

    const clearStorage = () => {
      const ok = confirm("Wipe ALL local entries? (Nuclear option)");
      if (!ok) return;
      localStorage.removeItem(STORAGE_KEY);
      loadPosts();
      sortPosts();
      savePosts();
      renderList();
      renderCmdHelp();
    };

    const runCommand = (raw) => {
      const input = (raw || "").trim();
      if (!input) return renderCmdHelp();

      const [cmd, ...rest] = input.split(" ");
      const arg = rest.join(" ").trim();

      switch (cmd.toLowerCase()) {
        case "help":
          renderCmdHelp();
          break;
        case "new":
          closeCmd();
          openNew();
          break;
        case "search":
          renderSearchResults(arg);
          renderList(arg);
          break;
        case "open": {
          const n = Number(arg);
          if (!Number.isFinite(n) || n < 1 || n > lastSearchResults.length) {
            $("cmdResults").innerHTML = `<div>Invalid index. Use <span class="text-white">open 1</span> .. <span class="text-white">open ${lastSearchResults.length}</span></div>`;
            return;
          }
          const post = lastSearchResults[n - 1];
          closeCmd();
          openPost(post.id);
          break;
        }
        case "export":
          exportJSON();
          $("cmdResults").innerHTML = `<div class="text-gray-400">Exported. (Check downloads)</div>`;
          break;
        case "clear":
          clearStorage();
          break;
        default:
          // default behavior: treat as search
          renderSearchResults(input);
          renderList(input);
          break;
      }
    };

    /***********************
     *  Events
     ***********************/
    $("btnBack").addEventListener("click", hideReader);
    $("newPostBtn").addEventListener("click", openNew);

    $("btnEdit").addEventListener("click", () => {
      const isEdit = !$("editMode").classList.contains("hidden");
      if (isEdit) {
        // switch to view with current editor values (preview)
        const temp = {
          title: ($("eTitle").value || "").trim() || "Untitled",
          date: $("eDate").value || safeISODate(),
          tags: normalizeTags($("eTags").value),
          body: $("eBody").value || ""
        };
        $("vTitle").innerText = temp.title;
        $("vMeta").innerText = `${temp.date}${temp.tags.length ? " ¬∑ " + temp.tags.join(" ¬∑ ") : ""}`;
        $("vBody").innerHTML = renderMarkdown(temp.body);
        setMode("view");
      } else {
        setMode("edit");
        $("eTitle").focus();
      }
    });

    $("btnSave").addEventListener("click", upsertActive);
    $("btnDelete").addEventListener("click", deleteActive);

    $("cmdBtn").addEventListener("click", openCmd);
    $("cmdOverlay").addEventListener("click", closeCmd);

    $("cmdInput").addEventListener("input", (e) => {
      const v = e.target.value || "";
      // live preview search when user types without explicit command
      if (!v.trim()) return renderCmdHelp();
      if (/^(new|help|export|clear|open|search)\b/i.test(v.trim())) return; // wait enter for commands
      renderSearchResults(v);
      renderList(v);
    });

    $("cmdInput").addEventListener("keydown", (e) => {
      if (e.key === "Enter") runCommand(e.target.value);
      if (e.key === "Escape") closeCmd();
    });

    document.addEventListener("keydown", (e) => {
      const isMacCmd = e.metaKey;
      const key = e.key.toLowerCase();

      // CMD+K
      if (isMacCmd && key === "k") {
        e.preventDefault();
        if ($("cmd").classList.contains("hidden")) openCmd();
        else closeCmd();
      }

      // CMD+N
      if (isMacCmd && key === "n") {
        e.preventDefault();
        closeCmd();
        openNew();
      }

      // ESC
      if (e.key === "Escape") {
        if (!$("cmd").classList.contains("hidden")) return closeCmd();
        if (!$("readerOverlay").classList.contains("hidden")) return hideReader();
      }
    });

    /***********************
     *  Init
     ***********************/
    loadPosts();
    sortPosts();
    savePosts();
    renderList();
  </script>
</body>
</html>
